document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("status"),t=document.getElementById("user-info"),o=document.getElementById("user-email"),n=document.getElementById("login-section"),r=document.getElementById("login-button"),s=document.getElementById("logout-button"),u=document.getElementById("error-message");function i(e){u.textContent=e}function a(s){i(""),s?(e.textContent="ステータス: ログイン済み",o.textContent=s.displayName||s.email,n.style.display="none",t.style.display="block"):(e.textContent="ステータス: 未ログイン",n.style.display="block",t.style.display="none"),r.disabled=!1,r.textContent="Googleアカウントでログイン"}r.addEventListener("click",(function(){r.disabled=!0,r.textContent="ログイン処理中...",i(""),chrome.runtime.sendMessage({action:"requestLogin"},(function(t){if(chrome.runtime.lastError)return console.error("Login request error:",chrome.runtime.lastError.message),i(`ログイン開始エラー: ${chrome.runtime.lastError.message}`),r.disabled=!1,void(r.textContent="Googleアカウントでログイン");t&&t.started?e.textContent="Googleアカウントを選択してください...":(i(t?.error||"ログインを開始できませんでした。"),r.disabled=!1,r.textContent="Googleアカウントでログイン")}))})),s.addEventListener("click",(function(){s.disabled=!0,s.textContent="ログアウト中...",chrome.runtime.sendMessage({action:"requestLogout"},(function(e){chrome.runtime.lastError||!e?.success?(console.error("Logout request error:",chrome.runtime.lastError?.message||e?.error),i(`ログアウトエラー: ${chrome.runtime.lastError?.message||e?.error}`)):console.log("Logout successful via popup request."),s.disabled=!1,s.textContent="ログアウト"}))})),e.textContent="ステータス: 認証状態を確認中...",chrome.runtime.sendMessage({action:"getAuthStatus"},(function(t){if(chrome.runtime.lastError)return console.error("Error getting auth status:",chrome.runtime.lastError.message),e.textContent="状態取得エラー",i(`状態取得エラー: ${chrome.runtime.lastError.message}`),void a(null);console.log("Initial auth status from background:",t?.user),a(t?.user)})),chrome.runtime.onMessage.addListener(((e,t,o)=>{if("authStatusChanged"===e.action)return console.log("Popup received auth status update from background:",e.user),a(e.user),!0})),console.log("Popup script initialized.")}));